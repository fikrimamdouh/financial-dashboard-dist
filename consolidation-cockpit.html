<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø­ÙƒÙ…Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© - Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø© | Polaris</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Tajawal:wght@400;500;700&display=swap');
        
        :root { 
            --font-family-main: 'Tajawal', sans-serif;
            --font-family-display: 'Orbitron', sans-serif; 
            --color-primary-glow: #00BFFF;
            --color-bg: #010409;
            --color-surface: rgba(13, 17, 23, 0.8); 
            --color-border: rgba(56, 139, 253, 0.3);
            --color-text-primary: #E6EDF3;
            --color-text-secondary: #7D8590;
            --color-warning: #ffc107;
            --color-success: #28a745;
            --color-danger: #dc3545;
        }
        
        body { 
            font-family: var(--font-family-main);
            direction: rtl;
            background-color: var(--color-bg);
            color: var(--color-text-primary);
        }
        
        .grid-background { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(to right, rgba(56, 139, 253, 0.1) 1px, transparent 1px), 
                              linear-gradient(to bottom, rgba(56, 139, 253, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -2;
        }
        
        .glow-background { 
            position: fixed;
            top: 50%;
            left: 50%;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(0, 191, 255, 0.1), transparent 60%);
            transform: translate(-50%, -50%);
            animation: pulse 10s infinite ease-in-out;
            z-index: -1;
        }
        
        @keyframes pulse { 
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; } 
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; } 
        }
        
        .main-content { padding: 2rem; }
        
        .page-header { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 1rem;
        }
        
        .page-title { 
            font-family: var(--font-family-display);
            font-size: 2.5rem;
            color: var(--color-primary-glow);
            text-shadow: 0 0 15px var(--color-primary-glow);
            margin: 0;
        }
        
        .sidebar-nav {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(5px);
        }
        
        .nav-pills .nav-link {
            color: var(--color-text-primary);
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: rgba(0, 191, 255, 0.1);
            color: var(--color-primary-glow);
        }
        
        .nav-pills .nav-link.active {
            background-color: var(--color-primary-glow);
            color: var(--color-bg);
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.5);
        }
        
        .report-section {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(5px);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--color-primary-glow);
        }
        
        .report-title {
            font-family: var(--font-family-display);
            font-size: 1.8rem;
            color: var(--color-primary-glow);
            margin: 0;
        }
        
        .report-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-action {
            background-color: transparent;
            border: 1px solid var(--color-border);
            color: var(--color-text-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-action:hover {
            background-color: var(--color-primary-glow);
            border-color: var(--color-primary-glow);
            color: var(--color-bg);
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .fs-table {
            width: 100%;
            color: var(--color-text-primary);
            margin-bottom: 2rem;
            font-size: 0.95rem;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .fs-table th,
        .fs-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--color-border);
            vertical-align: middle;
        }
        
        .fs-table thead th {
            background-color: rgba(0, 191, 255, 0.1);
            color: var(--color-primary-glow);
            font-weight: 700;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .fs-table tbody tr:hover {
            background-color: rgba(0, 191, 255, 0.05);
        }
        
        .fs-group-header {
            font-family: var(--font-family-display);
            font-size: 1.1rem;
            color: var(--color-primary-glow);
            font-weight: 700;
            padding-top: 1.5rem !important;
            background-color: rgba(0, 191, 255, 0.05);
        }
        
        .fs-subgroup-header {
            font-weight: 600;
            color: var(--color-text-primary);
            background-color: rgba(255, 255, 255, 0.02);
            padding-right: 2rem !important;
        }
        
        .fs-item-row td:first-child {
            padding-right: 3rem;
        }
        
        .fs-total-row {
            font-weight: 700;
            border-top: 2px solid var(--color-primary-glow);
            background-color: rgba(0, 191, 255, 0.1);
        }
        
        .amount {
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
            text-align: left;
            direction: ltr;
        }
        
        .text-center {
            text-align: center !important;
        }
        
        .view-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .toggle-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-border);
            background-color: transparent;
            color: var(--color-text-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-btn.active {
            background-color: var(--color-primary-glow);
            border-color: var(--color-primary-glow);
            color: var(--color-bg);
        }
        
        .toggle-btn:hover {
            border-color: var(--color-primary-glow);
            color: var(--color-primary-glow);
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .report-section {
                page-break-inside: avoid;
                border: none;
                box-shadow: none;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .fs-table th,
            .fs-table td {
                color: black;
            }
        }
        
        .company-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--color-border);
        }
        
        .company-name {
            font-family: var(--font-family-display);
            font-size: 1.5rem;
            color: var(--color-primary-glow);
            margin-bottom: 0.5rem;
        }
        
        .report-period {
            color: var(--color-text-secondary);
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="grid-background"></div>
    <div class="glow-background"></div>

    <main class="main-content">
        <div class="page-header no-print">
            <div>
                <h1 class="page-title">Ù…Ù†ØµØ© Ø§Ù„Ø­ÙƒÙ…Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h1>
                <p class="text-secondary mb-0" id="clientNameSubtitle">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</p>
            </div>
            <div>
                <button class="btn btn-action" onclick="window.location.href='account-mapping.html'">
                    <i class="fas fa-arrow-right me-2"></i>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                </button>
            </div>
        </div>

        <div id="loader" class="text-center mt-5">
            <div class="spinner-border text-info" role="status"></div>
            <p class="mt-2">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©...</p>
        </div>

        <div id="appContainer" style="display: none;">
            <div class="row">
                <div class="col-md-3 no-print">
                    <div class="sidebar-nav">
                        <h5 class="mb-3" style="color: var(--color-primary-glow);">
                            <i class="fas fa-list me-2"></i>Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                        </h5>
                        <ul class="nav nav-pills flex-column" id="reportsNav">
                            <li class="nav-item">
                                <a class="nav-link active" href="#trial-balance" data-bs-toggle="pill">
                                    <i class="fas fa-balance-scale me-2"></i>Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#balance-sheet" data-bs-toggle="pill">
                                    <i class="fas fa-file-invoice me-2"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„ÙŠ
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#income-statement" data-bs-toggle="pill">
                                    <i class="fas fa-chart-line me-2"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ø§Ù…Ù„
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#cash-flow" data-bs-toggle="pill">
                                    <i class="fas fa-money-bill-wave me-2"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                                </a>
                            </li>
                            <li class="nav-item mt-3">
                                <h6 style="color: var(--color-text-secondary); padding: 0.5rem;">Ø§Ù„Ø¥ÙŠØ¶Ø§Ø­Ø§Øª Ø§Ù„Ù…ØªÙ…Ù…Ø©</h6>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-cash" data-bs-toggle="pill">
                                    <i class="fas fa-coins me-2"></i>Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-receivables" data-bs-toggle="pill">
                                    <i class="fas fa-users me-2"></i>Ø§Ù„Ø°Ù…Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-inventory" data-bs-toggle="pill">
                                    <i class="fas fa-boxes me-2"></i>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-fixed-assets" data-bs-toggle="pill">
                                    <i class="fas fa-building me-2"></i>Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø«Ø§Ø¨ØªØ©
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-payables" data-bs-toggle="pill">
                                    <i class="fas fa-file-invoice-dollar me-2"></i>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-creditors" data-bs-toggle="pill">
                                    <i class="fas fa-hand-holding-usd me-2"></i>Ø§Ù„Ø¯Ø§Ø¦Ù†ÙˆÙ†
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-equity" data-bs-toggle="pill">
                                    <i class="fas fa-landmark me-2"></i>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-revenue" data-bs-toggle="pill">
                                    <i class="fas fa-dollar-sign me-2"></i>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-expenses" data-bs-toggle="pill">
                                    <i class="fas fa-receipt me-2"></i>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-other-revenue" data-bs-toggle="pill">
                                    <i class="fas fa-plus-circle me-2"></i>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø£Ø®Ø±Ù‰
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#note-other-payables" data-bs-toggle="pill">
                                    <i class="fas fa-clipboard-list me-2"></i>Ø£Ø±ØµØ¯Ø© Ø¯Ø§Ø¦Ù†Ø© Ø£Ø®Ø±Ù‰
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-9">
                    <div class="tab-content" id="reportsContent">
                        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let excelData = {};
        let companyInfo = {};

        document.addEventListener('DOMContentLoaded', async () => {
            console.log("ğŸš€ ØªØ­Ù…ÙŠÙ„ Ù…Ù†ØµØ© Ø§Ù„Ø­ÙƒÙ…Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©...");
            
            try {
                await loadExcelFile();
                renderAllReports();
                
                document.getElementById('loader').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                document.getElementById('loader').innerHTML = `
                    <div class="alert alert-danger">
                        <h4>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        });

        async function loadExcelFile() {
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage (Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ÙÙŠ reporting-pantheon)
            const activeClientId = localStorage.getItem('activeClientId') || 'default';
            const savedAuditFile = localStorage.getItem(`polarisAuditFile_${activeClientId}`);
            
            if (savedAuditFile) {
                const auditFile = JSON.parse(savedAuditFile);
                
                // ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª auditFile Ø¥Ù„Ù‰ excelData
                if (auditFile.trialBalance) {
                    excelData['Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© 2024'] = auditFile.trialBalance;
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
                if (auditFile.clientInfo) {
                    companyInfo = auditFile.clientInfo;
                }
                
                console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage", {
                    clientId: activeClientId,
                    company: companyInfo.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    trialBalanceRows: auditFile.trialBalance?.length || 0
                });
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorageØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ Ù…Ù† financial-data.json
                try {
                    const response = await fetch('financial-data.json');
                    excelData = await response.json();
                    console.log("âš ï¸ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù Ø§Ø­ØªÙŠØ§Ø·ÙŠ", Object.keys(excelData));
                } catch (error) {
                    console.error("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                    throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ù…Ù„Ù Excel ÙÙŠ reporting-pantheon.html Ø£ÙˆÙ„Ø§Ù‹.');
                }
            }
        }

        function renderAllReports() {
            const container = document.getElementById('reportsContent');
            
            container.innerHTML = `
                ${renderTrialBalance()}
                ${renderBalanceSheet()}
                ${renderIncomeStatement()}
                ${renderCashFlow()}
                ${renderNoteCash()}
                ${renderNoteReceivables()}
                ${renderNoteInventory()}
                ${renderNoteFixedAssets()}
                ${renderNotePayables()}
                ${renderNoteCreditors()}
                ${renderNoteEquity()}
                ${renderNoteRevenue()}
                ${renderNoteExpenses()}
                ${renderNoteOtherRevenue()}
                ${renderNoteOtherPayables()}
            `;
        }

        function renderTrialBalance() {
            const data = excelData['Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© 2024'] || [];
            if (data.length === 0) return '';
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ù…Ù† Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£ÙˆÙ„Ù‰
            const companyName = "Ù…ØµÙ†Ø¹ Ø¨Ù† Ø­Ø§Ù…Ø¯ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ù…Ù†ØªÙŠØ©";
            const period = "2024/12/31";
            
            let tableRows = '';
            let startRow = 3; // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ (Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†)
            
            for (let i = startRow; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                const accountName = row[12] || '';
                const accountCode = row[13] || '';
                const openingDebit = formatNumber(row[11]);
                const openingCredit = formatNumber(row[10]);
                const movementDebit = formatNumber(row[9]);
                const movementCredit = formatNumber(row[8]);
                const closingDebit = formatNumber(row[7]);
                const closingCredit = formatNumber(row[6]);
                
                if (accountName) {
                    tableRows += `
                        <tr>
                            <td>${accountCode}</td>
                            <td>${accountName}</td>
                            <td class="amount">${openingDebit}</td>
                            <td class="amount">${openingCredit}</td>
                            <td class="amount">${movementDebit}</td>
                            <td class="amount">${movementCredit}</td>
                            <td class="amount">${closingDebit}</td>
                            <td class="amount">${closingCredit}</td>
                        </tr>
                    `;
                }
            }
            
            return `
                <div class="tab-pane fade show active" id="trial-balance">
                    <div class="report-section">
                        <div class="company-header">
                            <div class="company-name">${companyName}</div>
                            <div class="report-period">Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¹Ø§Ù…</div>
                            <div class="report-period">Ø®Ù„Ø§Ù„ Ø§Ù„ÙØªØ±Ø© Ù…Ù† 2024/01/01 Ø¥Ù„Ù‰ ${period}</div>
                        </div>
                        
                        <div class="report-header no-print">
                            <h2 class="report-title">Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h2>
                            <div class="report-actions">
                                <button class="btn-action" onclick="printReport('trial-balance')">
                                    <i class="fas fa-print me-2"></i>Ø·Ø¨Ø§Ø¹Ø©
                                </button>
                                <button class="btn-action" onclick="exportToExcel('trial-balance', 'Ù…ÙŠØ²Ø§Ù†_Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©')">
                                    <i class="fas fa-file-excel me-2"></i>ØªØµØ¯ÙŠØ± Excel
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="fs-table">
                                <thead>
                                    <tr>
                                        <th>ÙƒÙˆØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                                        <th>Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                                        <th>Ø£ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø© Ù…Ø¯ÙŠÙ†</th>
                                        <th>Ø£ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø© Ø¯Ø§Ø¦Ù†</th>
                                        <th>Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¯ÙŠÙ†</th>
                                        <th>Ø§Ù„Ø­Ø±ÙƒØ© Ø¯Ø§Ø¦Ù†</th>
                                        <th>Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ø¯ÙŠÙ†</th>
                                        <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBalanceSheet() {
            const data = excelData['Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„'] || [];
            if (data.length === 0) return '';
            
            const companyName = data[1] ? data[1][1] : "Ù…ØµÙ†Ø¹ Ø¨Ù† Ø­Ø§Ù…Ø¯ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ù…Ù†ØªÙŠØ©";
            const period = "2024/12/31";
            
            let tableRows = '';
            for (let i = 4; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                const itemName = row[1] || '';
                const noteRef = row[2] || '';
                const amount = formatNumber(row[3]);
                
                if (!itemName) continue;
                
                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØµÙ
                if (itemName.includes('Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø§Øª') || itemName.includes('Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø§Øª') || itemName.includes('Ø­Ù‚ÙˆÙ‚')) {
                    tableRows += `
                        <tr class="fs-group-header">
                            <td colspan="3"><strong>${itemName}</strong></td>
                        </tr>
                    `;
                } else if (itemName.includes('Ø¥Ø¬Ù…Ø§Ù„ÙŠ')) {
                    tableRows += `
                        <tr class="fs-total-row">
                            <td><strong>${itemName}</strong></td>
                            <td class="text-center">${noteRef}</td>
                            <td class="amount"><strong>${amount}</strong></td>
                        </tr>
                    `;
                } else {
                    tableRows += `
                        <tr class="fs-item-row">
                            <td>${itemName}</td>
                            <td class="text-center">${noteRef}</td>
                            <td class="amount">${amount}</td>
                        </tr>
                    `;
                }
            }
            
            return `
                <div class="tab-pane fade" id="balance-sheet">
                    <div class="report-section">
                        <div class="company-header">
                            <div class="company-name">${companyName}</div>
                            <div class="report-period">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„ÙŠ ÙÙŠ ${period}Ù…</div>
                        </div>
                        
                        <div class="report-header no-print">
                            <h2 class="report-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„ÙŠ</h2>
                            <div class="report-actions">
                                <button class="btn-action" onclick="printReport('balance-sheet')">
                                    <i class="fas fa-print me-2"></i>Ø·Ø¨Ø§Ø¹Ø©
                                </button>
                                <button class="btn-action" onclick="exportToExcel('balance-sheet', 'Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ù…Ø±ÙƒØ²_Ø§Ù„Ù…Ø§Ù„ÙŠ')">
                                    <i class="fas fa-file-excel me-2"></i>ØªØµØ¯ÙŠØ± Excel
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="fs-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                        <th>Ø¥ÙŠØ¶Ø§Ø­</th>
                                        <th>Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIncomeStatement() {
            const data = excelData['Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ø§Ù…Ù„'] || [];
            if (data.length === 0) return '';
            
            const companyName = "Ù…ØµÙ†Ø¹ Ø¨Ù† Ø­Ø§Ù…Ø¯ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ù…Ù†ØªÙŠØ©";
            const period = "2024/12/31";
            
            let tableRows = '';
            for (let i = 3; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                const itemName = row[1] || '';
                const noteRef = row[2] || '';
                const amount = formatNumber(row[3]);
                
                if (!itemName) continue;
                
                if (itemName.includes('Ø¥Ø¬Ù…Ø§Ù„ÙŠ') || itemName.includes('ØµØ§ÙÙŠ')) {
                    tableRows += `
                        <tr class="fs-total-row">
                            <td><strong>${itemName}</strong></td>
                            <td class="text-center">${noteRef}</td>
                            <td class="amount"><strong>${amount}</strong></td>
                        </tr>
                    `;
                } else {
                    tableRows += `
                        <tr class="fs-item-row">
                            <td>${itemName}</td>
                            <td class="text-center">${noteRef}</td>
                            <td class="amount">${amount}</td>
                        </tr>
                    `;
                }
            }
            
            return `
                <div class="tab-pane fade" id="income-statement">
                    <div class="report-section">
                        <div class="company-header">
                            <div class="company-name">${companyName}</div>
                            <div class="report-period">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© ÙÙŠ ${period}Ù…</div>
                        </div>
                        
                        <div class="report-header no-print">
                            <h2 class="report-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                            <div class="report-actions">
                                <button class="btn-action" onclick="printReport('income-statement')">
                                    <i class="fas fa-print me-2"></i>Ø·Ø¨Ø§Ø¹Ø©
                                </button>
                                <button class="btn-action" onclick="exportToExcel('income-statement', 'Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ø¯Ø®Ù„')">
                                    <i class="fas fa-file-excel me-2"></i>ØªØµØ¯ÙŠØ± Excel
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="fs-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                        <th>Ø¥ÙŠØ¶Ø§Ø­</th>
                                        <th>Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCashFlow() {
            const tbData = excelData['Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© 2024'] || [];
            const companyName = "Ù…ØµÙ†Ø¹ Ø¨Ù† Ø­Ø§Ù…Ø¯ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ù…Ù†ØªÙŠØ©";
            
            if (tbData.length === 0) {
                return `
                    <div class="tab-pane fade" id="cash-flow">
                        <div class="report-section">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
                            </div>
                        </div>
                    </div>
                `;
            }
            
            const cashFlowData = generateEnhancedCashFlow(tbData);
            const cashFlowHTML = generateCashFlowHTML(cashFlowData, companyName);
            
            return `
                <div class="tab-pane fade" id="cash-flow">
                    <div class="report-section">
                        ${cashFlowHTML}
                    </div>
                </div>
            `;
        }

        function renderNote(noteId, sheetName, title, icon) {
            const data = excelData[sheetName] || [];
            if (data.length === 0) {
                return `
                    <div class="tab-pane fade" id="${noteId}">
                        <div class="report-section">
                            <div class="alert alert-warning">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¥ÙŠØ¶Ø§Ø­
                            </div>
                        </div>
                    </div>
                `;
            }
            
            let tableRows = '';
            let headers = [];
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            for (let i = 0; i < data.length; i++) {
                const row = data[i];
                if (row && row.some(cell => cell && cell.toString().trim())) {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
                    if (row.some(cell => cell && (cell.toString().includes('Ø§Ù„Ø¨ÙŠØ§Ù†') || cell.toString().includes('Ø§Ù„Ø­Ø³Ø§Ø¨')))) {
                        headers = row.filter(cell => cell && cell.toString().trim());
                        break;
                    }
                }
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø¹Ù†Ø§ÙˆÙŠÙ†ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            if (headers.length === 0) {
                headers = ['Ø§Ù„Ø¨ÙŠØ§Ù†', 'Ø§Ù„Ù…Ø¨Ù„Øº'];
            }
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            let startDataRow = headers.length > 0 ? 5 : 3;
            for (let i = startDataRow; i < data.length; i++) {
                const row = data[i];
                if (!row || !row.some(cell => cell && cell.toString().trim())) continue;
                
                let rowHtml = '<tr class="fs-item-row">';
                for (let j = 0; j < Math.min(row.length, headers.length); j++) {
                    const cell = row[j] || '';
                    const isNumber = !isNaN(parseFloat(cell)) && isFinite(cell);
                    rowHtml += `<td class="${isNumber ? 'amount' : ''}">${isNumber ? formatNumber(cell) : cell}</td>`;
                }
                rowHtml += '</tr>';
                tableRows += rowHtml;
            }
            
            return `
                <div class="tab-pane fade" id="${noteId}">
                    <div class="report-section">
                        <div class="company-header">
                            <div class="company-name">Ù…ØµÙ†Ø¹ Ø¨Ù† Ø­Ø§Ù…Ø¯ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ù…Ù†ØªÙŠØ©</div>
                            <div class="report-period">${title}</div>
                        </div>
                        
                        <div class="report-header no-print">
                            <h2 class="report-title">
                                <i class="${icon} me-2"></i>${title}
                            </h2>
                            <div class="report-actions">
                                <button class="btn-action" onclick="printReport('${noteId}')">
                                    <i class="fas fa-print me-2"></i>Ø·Ø¨Ø§Ø¹Ø©
                                </button>
                                <button class="btn-action" onclick="exportToExcel('${noteId}', '${title.replace(/\s/g, '_')}')">
                                    <i class="fas fa-file-excel me-2"></i>ØªØµØ¯ÙŠØ± Excel
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="fs-table">
                                <thead>
                                    <tr>
                                        ${headers.map(h => `<th>${h}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderNoteCash() {
            return renderNote('note-cash', 'Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©', 'fas fa-coins');
        }

        function renderNoteReceivables() {
            return renderNote('note-receivables', 'Ø°Ù…Ù… Ù…Ø¯ÙŠÙ†Ø©', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ø°Ù…Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'fas fa-users');
        }

        function renderNoteInventory() {
            return renderNote('note-inventory', 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ† 2024', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'fas fa-boxes');
        }

        function renderNoteFixedAssets() {
            return renderNote('note-fixed-assets', 'Ø§Ù„Ø§ØµÙˆÙ„ Ø§Ù„Ø«Ø§Ø¨ØªØ©', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø«Ø§Ø¨ØªØ©', 'fas fa-building');
        }

        function renderNotePayables() {
            return renderNote('note-payables', 'Ø§ÙŠØ¶Ø§Ø­ 5 ( Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† )', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†', 'fas fa-file-invoice-dollar');
        }

        function renderNoteCreditors() {
            return renderNote('note-creditors', 'Ø§ÙŠØ¶Ø§Ø­ 6 ( Ø§Ù„Ø¯Ø§Ø¦Ù†ÙˆÙ† )', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ø¯Ø§Ø¦Ù†ÙˆÙ†', 'fas fa-hand-holding-usd');
        }

        function renderNoteEquity() {
            return renderNote('note-equity', 'Ø§ÙŠØ¶Ø§Ø­ Ø±Ù‚Ù… 7 Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©', 'Ø¥ÙŠØ¶Ø§Ø­ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©', 'fas fa-landmark');
        }

        function renderNoteRevenue() {
            return renderNote('note-revenue', 'Ø§Ù„Ø§ÙŠØ±Ø§Ø¯Ø§Øª ', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', 'fas fa-dollar-sign');
        }

        function renderNoteExpenses() {
            return renderNote('note-expenses', 'Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ', 'fas fa-receipt');
        }

        function renderNoteOtherRevenue() {
            return renderNote('note-other-revenue', 'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø£Ø®Ø±ÙŠ ', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰', 'fas fa-plus-circle');
        }

        function renderNoteOtherPayables() {
            return renderNote('note-other-payables', 'Ø£Ø±ØµØ¯Ø©  Ø¯Ø§Ø¦Ù†Ø© Ø£Ø®Ø±ÙŠ', 'Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø¯Ø§Ø¦Ù†Ø© Ø§Ù„Ø£Ø®Ø±Ù‰', 'fas fa-clipboard-list');
        }

        function formatNumber(value) {
            if (!value || value === '') return '-';
            const num = parseFloat(value);
            if (isNaN(num)) return value;
            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

      function printReport(reportId) {
    const reportElement = document.getElementById(reportId);
    if (!reportElement) return;
    
    const printWindow = window.open('', '_blank');
    const reportContent = reportElement.innerHTML;
    
    printWindow.document.write(`
        <!DOCTYPE html>
        <html lang="ar" dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
            <style>
                body { 
                    font-family: 'Tajawal', Arial, sans-serif;
                    direction: rtl;
                    padding: 2rem;
                    background: white;
                    color: black;
                }
                .fs-table { 
                    width: 100%;
                    border-collapse: collapse;
                    margin-bottom: 2rem;
                }
                .fs-table th,
                .fs-table td {
                    padding: 0.75rem;
                    border: 1px solid #dee2e6;
                    text-align: right;
                }
                .fs-table thead th {
                    background-color: #f8f9fa;
                    font-weight: bold;
                    text-align: center;
                }
                .fs-group-header {
                    background-color: #e9ecef;
                    font-weight: bold;
                }
                .fs-total-row {
                    background-color: #f8f9fa;
                    font-weight: bold;
                    border-top: 2px solid #000;
                }
                .amount {
                    text-align: left;
                    direction: ltr;
                    font-family: 'Courier New', monospace;
                }
                .company-header {
                    text-align: center;
                    margin-bottom: 2rem;
                    padding-bottom: 1rem;
                    border-bottom: 2px solid #000;
                }
                .company-name {
                    font-size: 1.5rem;
                    font-weight: bold;
                    margin-bottom: 0.5rem;
                }
                .report-period {
                    font-size: 1rem;
                    color: #666;
                }
                @media print {
                    .no-print {
                        display: none !important;
                    }
                }
            </style>
        </head>
        <body>
            ${reportContent}
            <script>
                window.onload = function() {
                    window.print();
                    window.onafterprint = function() {
                        window.close();
                    };
                };
            </script>
        </body>
        </html>
    `);
    
    printWindow.document.close();
} // Ø¥ØºÙ„Ø§Ù‚ Ø¯Ø§Ù„Ø© printReport

function exportToExcel(reportId, filename) {
    alert('Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel Ù‚Ø±ÙŠØ¨Ø§Ù‹');
} // Ø¥ØºÙ„Ø§Ù‚ Ø¯Ø§Ù„Ø© exportToExcel
  
    </script>
    <script src="cashflow-engine.js"></script>
</body>
</html>

